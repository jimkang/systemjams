!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){function r(e){var t=e.split("-");return{pitch:t[0],duration:l({duration:t[1]}),velocity:114.3}}var o=e("tracery-grammar"),i=e("./get-next-time"),a=e("./play"),s=e("probable"),u=o.createGrammar({origin:["#intro# #verse# #chorus# #verse# #chorus# #breakdown# #chorus#"],intro:["#arpeggio# #chug# #arpeggio#","#chug# #chug# #slams#"],verse:["#chug# #chug# #chug# #tail#","#slams# #descend# #slams# #descend#"],chorus:["#wholenotes# #slams#","#slams# #slams# #arpeggio#"],breakdown:["#chug# #chug# #descend# #arpeggio#","#arpeggio# #descend# #arpeggio# #descend#"],arpeggio:["E4-8n,G4-8n,B5-8n,D5-8n,E5-8n,D5-8n,B5-8n,G4-8n","G4-8n,B5-8n,D5-8n,F\\#5-8n,G5-8n,F\\#5-8n,D5-8n,B5-8n"],chug:["E3-8n,E3-8n,E3-8n,E3-8n,E3-8n,E3-8n,E3-8n,E3-8n","E3-8n,E3-16n,E3-16n,E3-8n,E3-16n,E3-16n,E3-8n,E3-16n,E3-16n,E3-8n,E3-16n,E3-16n"],slams:["E3-4n,E3-4n,E3-4n,E3-4n","E3-4n,G3-4n,F\\#3-4n,E3-4n"],tail:["F\\#3-8n,E3-8n,G3-8n,F\\#3-8n,A4-8n,G3-8n,B5-4n","E3-4n,G3-4n,A\\#4-4n,E3-8n,A\\#5-8n"],descend:["A\\#4-8n,A4-8n,G\\#3-8n,G3-8n,G3-8n,F\\#3-8n,F3-8n,E3-8n","E4-8n,D4-8n,C4-8n,B4-8n,A4-8n,G3-8n,F\\#3-8n,E3-8n"],wholenotes:["F\\#4-1n,G4-1n,A4-1n,E4-1n","B4-1n,F\\#3-1n,G3-1n,A4-1n"]}),c=120+s.roll(120);document.querySelector("#bpm").textContent=c;var l=i({bpm:c}),f=u.flatten("#origin#");f=f.replace(/ /g,",");var d=f.split(",").map(r);a(d)},{"./get-next-time":2,"./play":8,probable:6,"tracery-grammar":7}],2:[function(e,t,n){function r(e){function t(e){var t=0,r=0;return e&&(e.start&&(r=e.start),t=e.duration?r+n(e.duration):r),t}function n(e){var t,n=parseInt(e.substr(0,e.length-1),10),r=e.substr(-1);return"n"===r?t=i/n:"t"===r&&(t=2*i/n/3),t}var r;e&&(r=e.bpm);var o=60/r,i=4*o;return t}t.exports=r},{}],3:[function(e,t,n){!function(){function e(e){this.message=e}var t="undefined"!=typeof n?n:this,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var n,o,i=0,a=r,s="";t.charAt(0|i)||(a="=",i%1);s+=a.charAt(63&n>>8-i%1*8)){if(o=t.charCodeAt(i+=.75),o>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|o}return s}),t.atob||(t.atob=function(t){if(t=t.replace(/=+$/,""),t.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,o,i=0,a=0,s="";o=t.charAt(a++);~o&&(n=i%4?64*n+o:o,i++%4)?s+=String.fromCharCode(255&n>>(-2*i&6)):0)o=r.indexOf(o);return s})}();var r={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=Math.ceil(3*e.length/4),n=new ArrayBuffer(t);return this.decode(e,n),n},decode:function(e,t){var n=this._keyStr.indexOf(e.charAt(e.length-1)),r=this._keyStr.indexOf(e.charAt(e.length-1)),o=Math.ceil(3*e.length/4);64==n&&o--,64==r&&o--;var i,a,s,u,c,l,f,d,h=0,p=0;for(i=t?new Uint8Array(t):new Uint8Array(o),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),h=0;o>h;h+=3)c=this._keyStr.indexOf(e.charAt(p++)),l=this._keyStr.indexOf(e.charAt(p++)),f=this._keyStr.indexOf(e.charAt(p++)),d=this._keyStr.indexOf(e.charAt(p++)),a=c<<2|l>>4,s=(15&l)<<4|f>>2,u=(3&f)<<6|d,i[h]=a,64!=f&&(i[h+1]=s),64!=d&&(i[h+2]=u);return i}};if(window.AudioContext=window.AudioContext||window.webkitAudioContext||null,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext||null,function(e){var t,n,r,o=function(e){return"[object Function]"===Object.prototype.toString.call(e)||"[object AudioContextConstructor]"===Object.prototype.toString.call(e)},i=[["createGainNode","createGain"],["createDelayNode","createDelay"],["createJavaScriptNode","createScriptProcessor"]];o(e)&&(n=new e,n.destination&&n.sampleRate&&(t=e.prototype,r=Object.getPrototypeOf(n.createBufferSource()),o(r.start)||o(r.noteOn)&&(r.start=function(e,t,n){switch(arguments.length){case 0:throw new Error("Not enough arguments.");case 1:this.noteOn(e);break;case 2:if(!this.buffer)throw new Error("Missing AudioBuffer");this.noteGrainOn(e,t,this.buffer.duration-t);break;case 3:this.noteGrainOn(e,t,n)}}),o(r.noteOn)||(r.noteOn=r.start),o(r.noteGrainOn)||(r.noteGrainOn=r.start),o(r.stop)||(r.stop=r.noteOff),o(r.noteOff)||(r.noteOff=r.stop),i.forEach(function(e){for(var t,n;e.length;)t=e.pop(),o(this[t])?this[e.pop()]=this[t]:(n=e.pop(),this[t]=this[n])},t)))}(window.AudioContext),"undefined"==typeof MIDI&&(MIDI={}),function(e){"use strict";var t={},n=0,r=function(e){n++;var r=document.body,o=new Audio,i=e.split(";")[0];o.id="audio",o.setAttribute("preload","auto"),o.setAttribute("audiobuffer",!0),o.addEventListener("error",function(){r.removeChild(o),t[i]=!1,n--},!1),o.addEventListener("canplaythrough",function(){r.removeChild(o),t[i]=!0,n--},!1),o.src="data:"+e,r.appendChild(o)};e.audioDetect=function(e){if(navigator.requestMIDIAccess){var o=Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf("[native code]");if(o)t.webmidi=!0;else for(var i=0;navigator.plugins.length>i;i++){var a=navigator.plugins[i];a.name.indexOf("Jazz-Plugin")>=0&&(t.webmidi=!0)}}if("undefined"==typeof Audio)return e({});t.audiotag=!0,(window.AudioContext||window.webkitAudioContext)&&(t.webaudio=!0);var s=new Audio;if("undefined"==typeof s.canPlayType)return e(t);var u=s.canPlayType('audio/ogg; codecs="vorbis"');u="probably"===u||"maybe"===u;var c=s.canPlayType("audio/mpeg");if(c="probably"===c||"maybe"===c,!u&&!c)return void e(t);u&&r("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),c&&r("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var l=(new Date).getTime(),f=window.setInterval(function(){var r=(new Date).getTime(),o=r-l>5e3;n&&!o||(window.clearInterval(f),e(t))},1)}}(MIDI),function(e){"use strict";e.GM=function(e){var t=function(e){return e.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},n={byName:{},byId:{},byCategory:{}};for(var r in e)for(var o=e[r],i=0,a=o.length;a>i;i++){var s=o[i];if(s){var u=parseInt(s.substr(0,s.indexOf(" ")),10);s=s.replace(u+" ",""),n.byId[--u]=n.byName[t(s)]=n.byCategory[t(r)]={id:t(s),instrument:s,number:u,category:r}}}return n}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),e.getInstrument=function(t){var n=e.channels[t];return n&&n.instrument},e.setInstrument=function(t,n,r){var o=e.channels[t];return r?setTimeout(function(){o.instrument=n},r):void(o.instrument=n)},e.getMono=function(t){var n=e.channels[t];return n&&n.mono},e.setMono=function(t,n,r){var o=e.channels[t];return r?setTimeout(function(){o.mono=n},r):void(o.mono=n)},e.getOmni=function(t){var n=e.channels[t];return n&&n.omni},e.setOmni=function(t,n){var r=e.channels[t];return delay?setTimeout(function(){r.omni=n},delay):void(r.omni=n)},e.getSolo=function(t){var n=e.channels[t];return n&&n.solo},e.setSolo=function(t,n){var r=e.channels[t];return delay?setTimeout(function(){r.solo=n},delay):void(r.solo=n)},e.channels=function(){for(var e={},t=0;16>t;t++)e[t]={instrument:t,pitchBend:0,mute:!1,mono:!1,omni:!1,solo:!1};return e}(),e.keyToNote={},e.noteToKey={},function(){for(var t=21,n=108,r=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],o=t;n>=o;o++){var i=(o-12)/12>>0,a=r[o%12]+i;e.keyToNote[a]=o,e.noteToKey[o]=a}}()}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),MIDI.Soundfont=MIDI.Soundfont||{},MIDI.Player=MIDI.Player||{},function(e){"use strict";e.DEBUG=!0,e.USE_XHR=!0,e.soundfontUrl="./soundfont/",e.loadPlugin=function(n){"function"==typeof n&&(n={onsuccess:n}),e.soundfontUrl=n.soundfontUrl||e.soundfontUrl,e.audioDetect(function(r){var o=window.location.hash,i="";if(r[n.api]?i=n.api:r[o.substr(1)]?i=o.substr(1):r.webmidi?i="webmidi":window.AudioContext?i="webaudio":window.Audio&&(i="audiotag"),t[i]){if(n.targetFormat)var a=n.targetFormat;else var a=r["audio/ogg"]?"ogg":"mp3";e.__api=i,e.__audioFormat=a,e.supports=r,e.loadResource(n)}})},e.loadResource=function(n){var r=n.instruments||n.instrument||"acoustic_grand_piano";"object"!=typeof r&&(r=r||0===r?[r]:[]);for(var o=0;o<r.length;o++){var i=r[o];i===+i&&e.GM.byId[i]&&(r[o]=e.GM.byId[i].id)}n.format=e.__audioFormat,n.instruments=r,t[e.__api](n)};var t={webmidi:function(t){e.WebMIDI.connect(t)},audiotag:function(e){n(e,"AudioTag")},webaudio:function(e){n(e,"WebAudio")}},n=function(t,n){for(var o=t.format,i=t.instruments,a=t.onprogress,s=t.onerror,u=i.length,c=u,l=function(){--c||(a&&a("load",1),e[n].connect(t))},f=0;u>f;f++){var d=i[f];MIDI.Soundfont[d]?l():r(i[f],o,function(e,t){var n=t/u,r=(u-c)/u;a&&a("load",n+r,d)},function(){l()},s)}},r=function(t,n,r,i,a){var s=e.soundfontUrl+t+"-"+n+".js";e.USE_XHR?e.util.request({url:s,format:"text",onerror:a,onprogress:r,onsuccess:function(e,t){var n=document.createElement("script");n.language="javascript",n.type="text/javascript",n.text=t,document.body.appendChild(n),i()}}):o.loadScript.add({url:s,verify:'MIDI.Soundfont["'+t+'"]',onerror:a,onsuccess:function(){i()}})};e.setDefaultPlugin=function(t){for(var n in t)e[n]=t[n]}}(MIDI),function(e){"use strict";window.Audio&&function(){for(var t=e.AudioTag={api:"audiotag"},n={},r=127,o=-1,i=[],a=[],s={},u=0;12>u;u++)i[u]=new Audio;var c=function(t,n){if(e.channels[t]){var u=e.channels[t].instrument,c=e.GM.byId[u].id,n=s[n];if(n){var l=c+""+n.id,f=(o+1)%i.length,d=i[f];if(a[f]=l,!e.Soundfont[c])return void(e.DEBUG&&console.log("404",c));d.src=e.Soundfont[c][n.id],d.volume=r/127,d.play(),o=f}}},l=function(t,n){if(e.channels[t]){var r=e.channels[t].instrument,u=e.GM.byId[r].id,n=s[n];if(n)for(var c=u+""+n.id,l=0,f=i.length;f>l;l++){var d=(l+o+1)%f,h=a[d];if(h&&h==c)return i[d].pause(),void(a[d]=null)}}};t.audioBuffers=i,t.send=function(e,t){},t.setController=function(e,t,n,r){},t.setVolume=function(e,t){r=t},t.programChange=function(t,n){e.channels[t].instrument=n},t.pitchBend=function(e,t,n){},t.noteOn=function(e,t,r,o){var i=n[t];if(s[i])return o?setTimeout(function(){c(e,i)},1e3*o):void c(e,i)},t.noteOff=function(e,t,n){},t.chordOn=function(e,t,r,o){for(var i=0;i<t.length;i++){var a=t[i],u=n[a];if(s[u]){if(o)return setTimeout(function(){c(e,u)},1e3*o);c(e,u)}}},t.chordOff=function(e,t,r){for(var o=0;o<t.length;o++){var i=t[o],a=n[i];if(s[a]){if(r)return setTimeout(function(){l(e,a)},1e3*r);l(e,a)}}},t.stopAllNotes=function(){for(var e=0,t=i.length;t>e;e++)i[e].pause()},t.connect=function(r){e.setDefaultPlugin(t);for(var o in e.keyToNote)n[e.keyToNote[o]]=o,s[o]={id:o};r.onsuccess&&r.onsuccess()}}()}(MIDI),function(e){"use strict";window.AudioContext&&function(){function t(e,t,n){if(i){var a=new Audio;a.src=e,a.controls=!1,a.autoplay=!1,a.preload=!1,a.addEventListener("canplay",function(){t&&t(a)}),a.addEventListener("error",function(e){n&&n(e)}),document.body.appendChild(a)}else if(0===e.indexOf("data:audio")){var s=e.split(",")[1],u=r.decodeArrayBuffer(s);o.decodeAudioData(u,t,n)}else{var c=new XMLHttpRequest;c.open("GET",e,!0),c.responseType="arraybuffer",c.onload=function(){o.decodeAudioData(c.response,t,n)},c.send()}}function n(){return new(window.AudioContext||window.webkitAudioContext)}var o,i=!1,a=e.WebAudio={api:"webaudio"},s={},u={},c=127,l={};a.audioBuffers=l,a.send=function(e,t){},a.setController=function(e,t,n,r){},a.setVolume=function(e,t,n){n?setTimeout(function(){c=t},1e3*n):c=t},a.programChange=function(t,n,r){var o=e.channels[t];o.instrument=n},a.pitchBend=function(t,n,r){var o=e.channels[t];o.pitchBend=n},a.noteOn=function(t,n,r,a){a=a||0;var f=e.channels[t],d=f.instrument,h=d+""+n,p=l[h];if(p){if(a<o.currentTime&&(a+=o.currentTime),i)var v=o.createMediaElementSource(p);else{var v=o.createBufferSource();v.buffer=p}if(u){var m=v;for(var g in u)m.connect(u[g].input),m=u[g]}var A=r/127*(c/127)*2-1;if(v.connect(o.destination),v.playbackRate.value=1,v.gainNode=o.createGain(),v.gainNode.connect(o.destination),v.gainNode.gain.value=Math.min(1,Math.max(-1,A)),v.connect(v.gainNode),i){if(a)return setTimeout(function(){p.currentTime=0,p.play()},1e3*a);p.currentTime=0,p.play()}else v.start(a||0);return s[t+""+n]=v,v}},a.noteOff=function(t,n,r){r=r||0;var a=e.channels[t],u=a.instrument,c=u+""+n,f=l[c];if(f){r<o.currentTime&&(r+=o.currentTime);var d=s[t+""+n];if(d){if(d.gainNode){var h=d.gainNode.gain;h.linearRampToValueAtTime(h.value,r),h.linearRampToValueAtTime(-1,r+.3)}return i?r?setTimeout(function(){f.pause()},1e3*r):f.pause():d.noteOff?d.noteOff(r+.5):d.stop(r+.5),delete s[t+""+n],d}}},a.chordOn=function(e,t,n,r){for(var o,i={},s=0,u=t.length;u>s;s++)i[o=t[s]]=a.noteOn(e,o,n,r);return i},a.chordOff=function(e,t,n){for(var r,o={},i=0,s=t.length;s>i;i++)o[r=t[i]]=a.noteOff(e,r,n);return o},a.stopAllNotes=function(){for(var e in s){var t=0;t<o.currentTime&&(t+=o.currentTime);var n=s[e];n.gain.linearRampToValueAtTime(1,t),n.gain.linearRampToValueAtTime(0,t+.3),n.noteOff?n.noteOff(t+.3):n.stop(t+.3),delete s[e]}},a.setEffects=function(e){if(!o.tunajs)return console.log("Effects module not installed.");for(var t=0;t<e.length;t++){var n=e[t],r=new o.tunajs[n.type](n);r.connect(o.destination),u[n.type]=r}},a.connect=function(t){e.setDefaultPlugin(a),a.setContext(o||n(),t.onsuccess)},a.getContext=function(){return o},a.setContext=function(n,r,i,a){o=n,"undefined"==typeof Tuna||o.tunajs||(o.tunajs=new Tuna(o));var s=[],u=e.keyToNote;for(var c in u)s.push(c);var f=function(e){for(var t in h)if(h[t])return;r&&(r(),r=null)},d=function(n,r,o,i){var a=n[i];a&&(h[r]++,t(a,function(t){t.id=i;var o=e.keyToNote[i];if(l[r+""+o]=t,0===--h[r]){n.isLoaded=!0,f(p)}},function(e){}))},h={};for(var p in e.Soundfont){var v=e.Soundfont[p];if(!v.isLoaded){var m=e.GM.byName[p],g=m.number;h[g]=0;for(var A=0;A<s.length;A++){var c=s[A];d(v,g,A,c)}}}setTimeout(f,1)}}()}(MIDI),function(e){"use strict";var t=null,n=null,r=e.WebMIDI={api:"webmidi"};r.send=function(e,t){n.send(e,1e3*t)},r.setController=function(e,t,r,o){n.send([e,t,r],1e3*o)},r.setVolume=function(e,t,r){n.send([176+e,7,t],1e3*r)},r.programChange=function(e,t,r){n.send([192+e,t],1e3*r)},r.pitchBend=function(e,t,r){n.send([224+e,t],1e3*r)},r.noteOn=function(e,t,r,o){n.send([144+e,t,r],1e3*o)},r.noteOff=function(e,t,r){n.send([128+e,t,0],1e3*r)},r.chordOn=function(e,t,r,o){for(var i=0;i<t.length;i++){var a=t[i];n.send([144+e,a,r],1e3*o)}},r.chordOff=function(e,t,r){for(var o=0;o<t.length;o++){var i=t[o];n.send([128+e,i,0],1e3*r)}},r.stopAllNotes=function(){n.cancel();for(var e=0;16>e;e++)n.send([176+e,123,0])},r.connect=function(o){e.setDefaultPlugin(r);var i=function(t){if(window.AudioContext)o.api="webaudio";else{if(!window.Audio)return;o.api="audiotag"}e.loadPlugin(o)};navigator.requestMIDIAccess().then(function(e){t=e;var r=t.outputs;n="function"==typeof r?r()[0]:r[0],void 0===n?i():o.onsuccess&&o.onsuccess()},i)}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),"undefined"==typeof MIDI.Player&&(MIDI.Player={}),function(){"use strict";var e=MIDI.Player;e.currentTime=0,e.endTime=0,e.restart=0,e.playing=!1,e.timeWarp=1,e.startDelay=0,e.BPM=120,e.start=e.resume=function(t){e.currentTime<-1&&(e.currentTime=-1),f(e.currentTime,null,t)},e.pause=function(){var t=e.restart;d(),e.restart=t},e.stop=function(){d(),e.restart=0,e.currentTime=0},e.addListener=function(e){a=e},e.removeListener=function(){a=void 0},e.clearAnimation=function(){e.animationFrameId&&cancelAnimationFrame(e.animationFrameId)},e.setAnimation=function(t){var n=0,r=0,o=0;e.clearAnimation();var a=function(){if(e.animationFrameId=requestAnimationFrame(a),0!==e.endTime){e.playing?(n=o===e.currentTime?r-Date.now():0,n=0===e.currentTime?0:e.currentTime-n,o!==e.currentTime&&(r=Date.now(),o=e.currentTime)):n=e.currentTime;var s=e.endTime,u=n/1e3,c=u/60,l=u-60*c,f=60*c+l,d=s/1e3;-1>d-f||t({now:f,end:d,events:i})}};requestAnimationFrame(a)},e.loadMidiFile=function(t,n,r){try{e.replayer=new Replayer(MidiFile(e.currentData),e.timeWarp,null,e.BPM),e.data=e.replayer.getData(),e.endTime=c(),MIDI.loadPlugin({onsuccess:t,onprogress:n,onerror:r})}catch(o){r&&r(o)}},e.loadFile=function(t,n,r,o){if(e.stop(),-1!==t.indexOf("base64,")){var i=window.atob(t.split(",")[1]);e.currentData=i,e.loadMidiFile(n,r,o)}else{var a=new XMLHttpRequest;a.open("GET",t),a.overrideMimeType("text/plain; charset=x-user-defined"),a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var t=this.responseText||"",i=[],a=t.length,s=String.fromCharCode,u=0;a>u;u++)i[u]=s(255&t.charCodeAt(u));var c=i.join("");e.currentData=c,e.loadMidiFile(n,r,o)}else o&&o("Unable to load MIDI file")},a.send()}},e.getFileInstruments=function(){for(var t={},n={},r=0;r<e.data.length;r++){var o=e.data[r][0].event;if("channel"===o.type){var i=o.channel;switch(o.subtype){case"controller":break;case"programChange":n[i]=o.programNumber;break;case"noteOn":var a=n[i],s=MIDI.GM.byId[isFinite(a)?a:i];t[s.id]=!0}}}var u=[];for(var c in t)u.push(c);return u};var t,n,r=[],o=0,i={},a=void 0,s=function(n,o,s,u,c,l,d){return setTimeout(function(){var u={channel:n,note:o,now:s,end:e.endTime,message:c,velocity:l};128===c?delete i[o]:i[o]=u,a&&a(u),e.currentTime=s,r.shift(),r.length<1e3?f(t,!0):e.currentTime===t&&t<e.endTime&&f(t,!0)},s-u)},u=function(){return"webaudio"===MIDI.api?MIDI.WebAudio.getContext():(e.ctx={currentTime:0},e.ctx)},c=function(){for(var t=e.data,n=t.length,r=.5,o=0;n>o;o++)r+=t[o][1];return r},l=function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},f=function(i,a,f){if(e.replayer){a||("undefined"==typeof i&&(i=e.restart),e.playing&&d(),e.playing=!0,e.data=e.replayer.getData(),e.endTime=c());var h,p=0,v=0,m=e.data,g=u(),A=m.length;t=.5;var y=(r[0]&&r[0].interval||0,i-e.currentTime);if("webaudio"!==MIDI.api){var b=l();n=n||b,g.currentTime=(b-n)/1e3}o=g.currentTime;for(var w=0;A>w&&100>v;w++){var q=m[w];if((t+=q[1])<=i)p=t;else{i=t-p;var S=q[0].event;if("channel"===S.type){var T=S.channel,I=MIDI.channels[T],x=g.currentTime+(i+y+e.startDelay)/1e3,E=t-p+e.startDelay;switch(S.subtype){case"controller":MIDI.setController(T,S.controllerType,S.value,x);break;case"programChange":MIDI.programChange(T,S.programNumber,x);break;case"pitchBend":MIDI.pitchBend(T,S.value,x);break;case"noteOn":if(I.mute)break;h=S.noteNumber-(e.MIDIOffset||0),r.push({event:S,time:E,source:MIDI.noteOn(T,S.noteNumber,S.velocity,x),interval:s(T,h,t+e.startDelay,p-y,144,S.velocity)}),v++;break;case"noteOff":if(I.mute)break;h=S.noteNumber-(e.MIDIOffset||0),r.push({event:S,time:E,source:MIDI.noteOff(T,S.noteNumber,x),interval:s(T,h,t,p-y,128,0)})}}}}f&&f(r)}},d=function(){var t=u();for(e.playing=!1,e.restart+=1e3*(t.currentTime-o);r.length;){var n=r.pop();window.clearInterval(n.interval),n.source&&("number"==typeof n.source?window.clearTimeout(n.source):n.source.disconnect(0))}for(var s in i){var n=i[s];144===i[s].message&&a&&a({channel:n.channel,note:n.note,now:n.now,end:n.end,message:128,velocity:n.velocity})}i={}}}(),"undefined"==typeof MIDI&&(MIDI={}),function(e){var t=e.util||(e.util={});t.request=function(t,n,r,o){"use strict";"string"==typeof t&&(t={url:t});var i=t.data,a=t.url,s=t.method||(t.data?"POST":"GET"),u=t.format,c=t.headers,l=t.responseType,f=t.withCredentials||!1,n=n||t.onsuccess,r=r||t.onerror,o=o||t.onprogress;if("undefined"!=typeof NodeFS&&e.loc.isLocalUrl(a))return void NodeFS.readFile(a,"utf8",function(e,t){e?r&&r(e):n&&n({responseText:t})});var d=new XMLHttpRequest;if(d.open(s,a,!0),c)for(var h in c)d.setRequestHeader(h,c[h]);else i&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded");return"binary"===u&&d.overrideMimeType&&d.overrideMimeType("text/plain; charset=x-user-defined"),l&&(d.responseType=l),f&&(d.withCredentials="true"),r&&"onerror"in d&&(d.onerror=r),o&&d.upload&&"onprogress"in d.upload&&(i?d.upload.onprogress=function(e){o.call(d,e,event.loaded/event.total)}:d.addEventListener("progress",function(e){var t=0;if(e.lengthComputable)t=e.total;else if(d.totalBytes)t=d.totalBytes;else{var n=parseInt(d.getResponseHeader("Content-Length-Raw"));if(!isFinite(n))return;d.totalBytes=t=n}o.call(d,e,e.loaded/t)})),d.onreadystatechange=function(t){if(4===d.readyState)if(200===d.status||304===d.status||308===d.status||0===d.status&&e.client.cordova){if(n){var o;if("xml"===u)o=t.target.responseXML;else if("text"===u)o=t.target.responseText;else if("json"===u)try{o=JSON.parse(t.target.response)}catch(i){r&&r.call(d,t)}n.call(d,t,o)}}else r&&r.call(d,t)},d.send(i),d}}(MIDI),"undefined"==typeof o)var o={};!function(){"use strict";o.loadScript=function(){return this.loaded={},this.loading={},this},o.loadScript.prototype.add=function(t){var n=this;"string"==typeof t&&(t={url:t});var r=t.urls;"undefined"==typeof r&&(r=[{url:t.url,verify:t.verify}]);var o=document.getElementsByTagName("head")[0],i=function(t,r){n.loaded[t.url]||r&&e(r)===!1||(n.loaded[t.url]=!0,n.loading[t.url]&&n.loading[t.url](),delete n.loading[t.url],t.onsuccess&&t.onsuccess(),"undefined"!=typeof d&&d())},a=!1,s=[],u=function(e){if("string"==typeof e&&(e={url:e,verify:t.verify}),/([\w\d.\[\]\'\"])$/.test(e.verify)){var r=e.test=e.verify;if("object"==typeof r)for(var u=0;u<r.length;u++)s.push(r[u]);else s.push(r)}if(!n.loaded[e.url]){var l=document.createElement("script");l.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||i(e)},l.onload=function(){i(e)},l.onerror=function(){if(a=!0,delete n.loading[e.url],"object"==typeof e.test)for(var t in e.test)c(e.test[t]);else c(e.test)},l.setAttribute("type","text/javascript"),l.setAttribute("src",e.url),o.appendChild(l),n.loading[e.url]=function(){}}},c=function(e){for(var t=[],n=0;n<s.length;n++)s[n]!==e&&t.push(s[n]);s=t},l=function(n){if(n)i(n,n.test);else for(var o=0;o<r.length;o++)i(r[o],r[o].test);for(var u=!0,o=0;o<s.length;o++)e(s[o])===!1&&(u=!1);!t.strictOrder&&u?a?t.error&&t.error():t.onsuccess&&t.onsuccess():setTimeout(function(){l(n)},10)};if(t.strictOrder){var f=-1,d=function(){if(f++,r[f]){var e=r[f],o=e.url;n.loading[o]?n.loading[o]=function(){e.onsuccess&&e.onsuccess(),d()}:n.loaded[o]?d():(u(e),l(e))}else a?t.error&&t.error():t.onsuccess&&t.onsuccess()};d()}else for(var f=0;f<r.length;f++)u(r[f]),l(r[f])},o.loadScript=new o.loadScript;var e=function(e,t){try{e=e.split('"').join("").split("'").join("").split("]").join("").split("[").join(".");for(var n=e.split("."),r=n.length,o=t||window,i=0;r>i;i++){var a=n[i];if(null==o[a])return!1;o=o[a]}return!0}catch(s){return!1}}}(),"undefined"!=typeof t&&t.exports&&(t.exports=o.loadScript)},{}],4:[function(e,t,n){function r(e,t,n){t=n?void 0:t;var a=o(e,i,void 0,void 0,void 0,void 0,void 0,t);return a.placeholder=r.placeholder,a}var o=e("lodash._createwrapper"),i=8;r.placeholder={},t.exports=r},{"lodash._createwrapper":5}],5:[function(e,t,n){(function(e){function r(e,t,n){var r=n.length;switch(r){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function o(e){return e&&e.Object===Object?e:null}function i(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&r++;return r}function a(e,t){return e="number"==typeof e||Y.test(e)?+e:-1,t=null==t?K:t,e>-1&&e%1==0&&t>e}function s(e,t){for(var n=-1,r=e.length,o=0,i=[];++n<r;){var a=e[n];a!==t&&a!==x||(e[n]=x,i[o++]=n)}return i}function u(e){return q(e)?oe(e):{}}function c(e,t,n,r){for(var o=-1,i=e.length,a=n.length,s=-1,u=t.length,c=ie(i-a,0),l=Array(u+c),f=!r;++s<u;)l[s]=t[s];for(;++o<a;)(f||i>o)&&(l[n[o]]=e[o]);for(;c--;)l[s++]=e[o++];return l}function l(e,t,n,r){for(var o=-1,i=e.length,a=-1,s=n.length,u=-1,c=t.length,l=ie(i-s,0),f=Array(l+c),d=!r;++o<l;)f[o]=e[o];for(var h=o;++u<c;)f[h+u]=t[u];for(;++a<s;)(d||i>o)&&(f[h+n[a]]=e[o++]);return f}function f(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function d(e,t,n){function r(){var t=this&&this!==te&&this instanceof r?i:e;return t.apply(o?n:this,arguments)}var o=t&E,i=h(e);return r}function h(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=u(e.prototype),r=e.apply(n,t);return q(r)?r:n}}function p(e,t,n){function o(){for(var a=arguments.length,u=Array(a),c=a,l=y(o);c--;)u[c]=arguments[c];var f=3>a&&u[0]!==l&&u[a-1]!==l?[]:s(u,l);if(a-=f.length,n>a)return g(e,t,v,o.placeholder,void 0,u,f,void 0,void 0,n-a);var d=this&&this!==te&&this instanceof o?i:e;return r(d,this,u)}var i=h(e);return o}function v(e,t,n,r,o,a,u,f,d,p){function m(){for(var x=arguments.length,E=x,M=Array(x);E--;)M[E]=arguments[E];if(S)var D=y(m),k=i(M,D);if(r&&(M=c(M,r,o,S)),a&&(M=l(M,a,u,S)),x-=k,S&&p>x){var C=s(M,D);return g(e,t,v,m.placeholder,n,M,C,f,d,p-x)}var F=w?n:this,O=q?F[e]:e;return x=M.length,f?M=b(M,f):T&&x>1&&M.reverse(),A&&x>d&&(M.length=d),this&&this!==te&&this instanceof m&&(O=I||h(O)),O.apply(F,M)}var A=t&R,w=t&E,q=t&M,S=t&(k|C),T=t&U,I=q?void 0:h(e);return m}function m(e,t,n,o){function i(){for(var t=-1,u=arguments.length,c=-1,l=o.length,f=Array(l+u),d=this&&this!==te&&this instanceof i?s:e;++c<l;)f[c]=o[c];for(;u--;)f[c++]=arguments[++t];return r(d,a?n:this,f)}var a=t&E,s=h(e);return i}function g(e,t,n,r,o,i,a,s,u,c){var l=t&k,d=s?f(s):void 0,h=l?a:void 0,p=l?void 0:a,v=l?i:void 0,m=l?void 0:i;t|=l?F:O,t&=~(l?O:F),t&D||(t&=~(E|M));var g=n(e,t,o,v,h,m,p,d,u,c);return g.placeholder=r,g}function A(e,t,n,r,o,i,a,s){var u=t&M;if(!u&&"function"!=typeof e)throw new TypeError(I);var c=r?r.length:0;if(c||(t&=~(F|O),r=o=void 0),a=void 0===a?a:ie(S(a),0),s=void 0===s?s:S(s),c-=o?o.length:0,t&O){var l=r,f=o;r=o=void 0}var h=[e,t,n,r,o,l,f,i,a,s];if(e=h[0],t=h[1],n=h[2],r=h[3],o=h[4],s=h[9]=null==h[9]?u?0:e.length:ie(h[9]-c,0),!s&&t&(k|C)&&(t&=~(k|C)),t&&t!=E)g=t==k||t==C?p(e,t,s):t!=F&&t!=(E|F)||o.length?v.apply(void 0,h):m(e,t,n,r);else var g=d(e,t,n);
return g}function y(e){var t=e;return t.placeholder}function b(e,t){for(var n=e.length,r=ae(t.length,n),o=f(e);r--;){var i=t[r];e[r]=a(i,n)?o[i]:void 0}return e}function w(e){var t=q(e)?re.call(e):"";return t==W||t==N}function q(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function S(e){if(!e)return 0===e?e:0;if(e=T(e),e===B||e===-B){var t=0>e?-1:1;return t*G}var n=e%1;return e===e?n?e-n:e:0}function T(e){if(q(e)){var t=w(e.valueOf)?e.valueOf():e;e=q(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(j,"");var n=V.test(e);return n||P.test(e)?X(e.slice(2),n?2:8):Z.test(e)?J:+e}var I="Expected a function",x="__lodash_placeholder__",E=1,M=2,D=4,k=8,C=16,F=32,O=64,R=128,U=512,B=1/0,K=9007199254740991,G=1.7976931348623157e308,J=NaN,W="[object Function]",N="[object GeneratorFunction]",j=/^\s+|\s+$/g,Z=/^[-+]0x[0-9a-f]+$/i,V=/^0b[01]+$/i,P=/^0o[0-7]+$/i,Y=/^(?:0|[1-9]\d*)$/,L={"function":!0,object:!0},X=parseInt,Q=L[typeof n]&&n&&!n.nodeType?n:void 0,H=L[typeof t]&&t&&!t.nodeType?t:void 0,z=o(Q&&H&&"object"==typeof e&&e),_=o(L[typeof self]&&self),$=o(L[typeof window]&&window),ee=o(L[typeof this]&&this),te=z||$!==(ee&&ee.window)&&$||_||ee||Function("return this")(),ne=Object.prototype,re=ne.toString,oe=Object.create,ie=Math.max,ae=Math.min;t.exports=A}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){function r(e){function t(e){return Math.floor(y()*e)}function n(e){return 0===e?0:t(e)+1}function r(e){function n(e){return o(a,e)}function r(){var e=n(t(s));return"function"!=typeof e||"probable_rollOnTable"!==e.name&&"probable_pick"!==e.name?e:e()}function i(){return a}var a=e,s=a[a.length-1][0][1]-a[0][0][0]+1;return{outcomeAtIndex:n,roll:r,length:s,getRangesAndOutcomesArray:i}}function o(e,t){t=+t;for(var n=0;n<e.length;++n){var r=e[n],o=r[0];if(t>=o[0]&&t<=o[1])return r[1]}}function i(e){return r(a(e))}function a(e){var t=[],n=-1,r=s(e);return r=r.sort(u),r.forEach(function(e){var r=e[0],o=e[1],i=n+1,a=i+r-1;t.push([[i,a],o]),n=a}),t}function s(e){var t=[];for(var n in e){var r=e[n];t.push([r,n])}return t}function u(e,t){return e[0]>t[0]?-1:1}function c(e){var t=l(e);return r(t)}function l(e){var t=[];for(var n in e){var r=d(n),o=e[n];if("object"==typeof o)if(Array.isArray(o))o=p(o);else{var i=c(o);"function"==typeof i.roll&&(o=i.roll)}t.push([r,o])}return t.sort(f)}function f(e,t){return e[0][0]<t[0][0]?-1:1}function d(e){var t=e.split("-");if(!(t.length>2))return 1===t.length?[+e,+e]:[+t[0],+t[1]]}function h(e,n){return!e||"number"!=typeof e.length||e.length<1?n:e[t(e.length)]}function p(e,t){return function(){return h(e,t)}}function v(e,t){var n=[];return e.forEach(function(e){t.forEach(function(t){Array.isArray(e)||Array.isArray(t)?n.push(e.concat(t)):n.push([e,t])})}),n}function m(e){return e.slice(1).reduce(v,e[0])}function g(e){for(var n,r=e.length,o=Array(r),i=0;r>i;i++)n=t(i+1),n!==i&&(o[i]=o[n]),o[n]=e[i];return o}function A(e,t){return g(e).slice(0,t)}var y=Math.random;return e&&e.random&&(y=e.random),{roll:t,rollDie:n,createRangeTable:r,createRangeTableFromDict:i,createTableFromDef:c,convertDictToRangesAndOutcomePairs:a,pickFromArray:h,crossArrays:v,getCartesianProduct:m,shuffle:g,sample:A}}var o=r();"object"==typeof t&&(t.exports=o,t.exports.createProbable=r)},{}],7:[function(e,t,n){var r=function(){function e(e,t){this.node=e;var n=t.split(":");this.target=n[0],1===n.length?this.type=2:(this.rule=n[1],"POP"===this.rule?this.type=1:this.type=0)}function t(e,t){this.raw=t,this.grammar=e,this.falloff=1,Array.isArray(t)?this.defaultRules=t:("string"==typeof t||t instanceof String)&&(this.defaultRules=[t])}function n(e,t){for(var n,r,o=e.length;0!==o;)r=Math.floor(Math.random()*o),o-=1,n=e[o],e[o]=e[r],e[r]=n;return e}function o(e){var t=e.toLowerCase();return"a"===t||"e"===t||"i"===t||"o"===t||"u"===t}function i(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e||e>="0"&&"9">=e}function a(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}var s=function(e,t,n){this.errors=[],void 0===n.raw&&(this.errors.push("Empty input for node"),n.raw=""),e instanceof r.Grammar?(this.grammar=e,this.parent=null,this.depth=0,this.childIndex=0):(this.grammar=e.grammar,this.parent=e,this.depth=e.depth+1,this.childIndex=t),this.raw=n.raw,this.type=n.type,this.isExpanded=!1,this.grammar||console.warn("No grammar specified for this node",this)};s.prototype.toString=function(){return"Node('"+this.raw+"' "+this.type+" d:"+this.depth+")"},s.prototype.expandChildren=function(e,t){if(this.children=[],this.finishedText="",this.childRule=e,void 0!==this.childRule){var n=r.parse(e);n.errors.length>0&&(this.errors=this.errors.concat(n.errors));for(var o=0;o<n.length;o++)this.children[o]=new s(this,o,n[o]),t||this.children[o].expand(t),this.finishedText+=this.children[o].finishedText}else this.errors.push("No child rule provided, can't expand children"),console.warn("No child rule provided, can't expand children")},s.prototype.expand=function(t){if(!this.isExpanded)switch(this.isExpanded=!0,this.expansionErrors=[],this.type){case-1:this.expandChildren(this.raw,t);break;case 0:this.finishedText=this.raw;break;case 1:this.preactions=[],this.postactions=[];var n=r.parseTag(this.raw);this.symbol=n.symbol,this.modifiers=n.modifiers;for(var o=0;o<n.preactions.length;o++)this.preactions[o]=new e(this,n.preactions[o].raw);for(var o=0;o<n.postactions.length;o++);for(var o=0;o<this.preactions.length;o++)0===this.preactions[o].type&&this.postactions.push(this.preactions[o].createUndo());for(var o=0;o<this.preactions.length;o++)this.preactions[o].activate();this.finishedText=this.raw;var i=this.grammar.selectRule(this.symbol,this,this.errors);this.expandChildren(i,t);for(var o=0;o<this.modifiers.length;o++){var a=this.modifiers[o],s=[];if(a.indexOf("(")>0){var u=/\(([^)]+)\)/,c=u.exec(this.modifiers[o]);if(!c||c.length<2);else{var s=c[1].split(",");a=this.modifiers[o].substring(0,a.indexOf("("))}}var l=this.grammar.modifiers[a];l?this.finishedText=l(this.finishedText,s):(this.errors.push("Missing modifier "+a),this.finishedText+="((."+a+"))")}for(var o=0;o<this.postactions.length;o++)this.postactions[o].activate();break;case 2:this.action=new e(this,this.raw),this.action.activate(),this.finishedText=""}},s.prototype.clearEscapeChars=function(){this.finishedText=this.finishedText.replace(/\\\\/g,"DOUBLEBACKSLASH").replace(/\\/g,"").replace(/DOUBLEBACKSLASH/g,"\\")},e.prototype.createUndo=function(){return 0===this.type?new e(this.node,this.target+":POP"):null},e.prototype.activate=function(){var e=this.node.grammar;switch(this.type){case 0:this.ruleSections=this.rule.split(","),this.finishedRules=[],this.ruleNodes=[];for(var t=0;t<this.ruleSections.length;t++){var n=new s(e,0,{type:-1,raw:this.ruleSections[t]});n.expand(),this.finishedRules.push(n.finishedText)}e.pushRules(this.target,this.finishedRules,this);break;case 1:e.popRules(this.target);break;case 2:e.flatten(this.target,!0)}},e.prototype.toText=function(){switch(this.type){case 0:return this.target+":"+this.rule;case 1:return this.target+":POP";case 2:return"((some function))";default:return"((Unknown Action))"}},t.prototype.selectRule=function(e){if(this.conditionalRule){var t=this.grammar.expand(this.conditionalRule,!0);if(this.conditionalValues[t]){var r=this.conditionalValues[t].selectRule(e);if(null!==r&&void 0!==r)return r}}if(this.ranking)for(var o=0;o<this.ranking.length;o++){var r=this.ranking.selectRule();if(null!==r&&void 0!==r)return r}if(void 0!==this.defaultRules){var i=0,a=this.distribution;switch(a||(a=this.grammar.distribution),a){case"shuffle":this.shuffledDeck&&0!==this.shuffledDeck.length||(this.shuffledDeck=n(Array.apply(null,{length:this.defaultRules.length}).map(Number.call,Number),this.falloff)),i=this.shuffledDeck.pop();break;case"weighted":e.push("Weighted distribution not yet implemented");break;case"falloff":e.push("Falloff distribution not yet implemented");break;default:i=Math.floor(Math.pow(Math.random(),this.falloff)*this.defaultRules.length)}return this.defaultUses||(this.defaultUses=[]),this.defaultUses[i]=++this.defaultUses[i]||1,this.defaultRules[i]}return e.push("No default rules defined for "+this),null},t.prototype.clearState=function(){this.defaultUses&&(this.defaultUses=[])};var u=function(e,n,r){this.key=n,this.grammar=e,this.rawRules=r,this.baseRules=new t(this.grammar,r),this.clearState()};u.prototype.clearState=function(){this.stack=[this.baseRules],this.uses=[],this.baseRules.clearState()},u.prototype.pushRules=function(e){var n=new t(this.grammar,e);this.stack.push(n)},u.prototype.popRules=function(){this.stack.pop()},u.prototype.selectRule=function(e,t){return this.uses.push({node:e}),0===this.stack.length?(t.push("The rule stack for '"+this.key+"' is empty, too many pops?"),"(("+this.key+"))"):this.stack[this.stack.length-1].selectRule()},u.prototype.getActiveRules=function(){return 0===this.stack.length?null:this.stack[this.stack.length-1].selectRule()},u.prototype.rulesToJSON=function(){return JSON.stringify(this.rawRules)};var c=function(e,t){this.modifiers={},this.loadFromRawObj(e)};c.prototype.clearState=function(){for(var e=Object.keys(this.symbols),t=0;t<e.length;t++)this.symbols[e[t]].clearState()},c.prototype.addModifiers=function(e){for(var t in e)e.hasOwnProperty(t)&&(this.modifiers[t]=e[t])},c.prototype.loadFromRawObj=function(e){if(this.raw=e,this.symbols={},this.subgrammars=[],this.raw)for(var t in this.raw)this.raw.hasOwnProperty(t)&&(this.symbols[t]=new u(this,t,this.raw[t]))},c.prototype.createRoot=function(e){var t=new s(this,0,{type:-1,raw:e});return t},c.prototype.expand=function(e,t){var n=this.createRoot(e);return n.expand(),t||n.clearEscapeChars(),n},c.prototype.flatten=function(e,t){var n=this.expand(e,t);return n.finishedText},c.prototype.toJSON=function(){for(var e=Object.keys(this.symbols),t=[],n=0;n<e.length;n++){var r=e[n];t.push(' "'+r+'" : '+this.symbols[r].rulesToJSON())}return"{\n"+t.join(",\n")+"\n}"},c.prototype.pushRules=function(e,t,n){void 0===this.symbols[e]?(this.symbols[e]=new u(this,e,t),n&&(this.symbols[e].isDynamic=!0)):this.symbols[e].pushRules(t)},c.prototype.popRules=function(e){this.symbols[e]||this.errors.push("Can't pop: no symbol for key "+e),this.symbols[e].popRules()},c.prototype.selectRule=function(e,t,n){if(this.symbols[e]){var r=this.symbols[e].selectRule(t,n);return r}for(var o=0;o<this.subgrammars.length;o++)if(this.subgrammars[o].symbols[e])return this.subgrammars[o].symbols[e].selectRule();return n.push("No symbol for '"+e+"'"),"(("+e+"))"},r={createGrammar:function(e){return new c(e)},parseTag:function(e){for(var t={symbol:void 0,preactions:[],postactions:[],modifiers:[]},n=r.parse(e),o=void 0,i=0;i<n.length;i++)if(0===n[i].type){if(void 0!==o)throw"multiple main sections in "+e;o=n[i].raw}else t.preactions.push(n[i]);if(void 0===o);else{var a=o.split(".");t.symbol=a[0],t.modifiers=a.slice(1)}return t},parse:function(e){function t(t,n,r){1>n-t&&(1===r&&a.push(t+": empty tag"),2===r&&a.push(t+": empty action"));var i;i=void 0!==c?u+"\\"+e.substring(c+1,n):e.substring(t,n),o.push({type:r,raw:i}),c=void 0,u=""}var n=0,r=!1,o=[],i=!1,a=[],s=0,u="",c=void 0;if(null===e){var o=[];return o.errors=a,o}for(var l=0;l<e.length;l++)if(i)i=!1;else{var f=e.charAt(l);switch(f){case"[":0!==n||r||(l>s&&t(s,l,0),s=l+1),n++;break;case"]":n--,0!==n||r||(t(s,l,2),s=l+1);break;case"#":0===n&&(r?(t(s,l,1),s=l+1):(l>s&&t(s,l,0),s=l+1),r=!r);break;case"\\":i=!0,u+=e.substring(s,l),s=l+1,c=l}}return s<e.length&&t(s,e.length,0),r&&a.push("Unclosed tag"),n>0&&a.push("Too many ["),0>n&&a.push("Too many ]"),o=o.filter(function(e){return 0!==e.type||0!==e.raw.length}),o.errors=a,o}};var l={replace:function(e,t){return e.replace(new RegExp(a(t[0]),"g"),t[1])},capitalizeAll:function(e){for(var t="",n=!0,r=0;r<e.length;r++)i(e.charAt(r))?n?(t+=e.charAt(r).toUpperCase(),n=!1):t+=e.charAt(r):(n=!0,t+=e.charAt(r));return t},capitalize:function(e){return e.charAt(0).toUpperCase()+e.substring(1)},a:function(e){if(e.length>0){if("u"===e.charAt(0).toLowerCase()&&e.length>2&&"i"===e.charAt(2).toLowerCase())return"a "+e;if(o(e.charAt(0)))return"an "+e}return"a "+e},firstS:function(e){console.log(e);var t=e.split(" "),n=l.s(t[0])+" "+t.slice(1).join(" ");return console.log(n),n},s:function(e){switch(e.charAt(e.length-1)){case"s":return e+"es";case"h":return e+"es";case"x":return e+"es";case"y":return o(e.charAt(e.length-2))?e+"s":e.substring(0,e.length-1)+"ies";default:return e+"s"}},ed:function(e){switch(e.charAt(e.length-1)){case"s":return e+"ed";case"e":return e+"d";case"h":return e+"ed";case"x":return e+"ed";case"y":return o(e.charAt(e.length-2))?e+"d":e.substring(0,e.length-1)+"ied";default:return e+"ed"}}};return r.baseEngModifiers=l,r.TraceryNode=s,r.Grammar=c,r.Symbol=u,r.RuleSet=t,r}();t.exports=r},{}],8:[function(e,t,n){function r(e){function t(){function t(e,t){var r=MIDI.keyToNote[t.pitch];r-=12,MIDI.noteOn(e,r,t.velocity,n[e]),MIDI.noteOff(e,r,n[e]+.9*t.duration),n[e]+=t.duration}var n=[0,0];MIDI.setVolume(0,127),e.forEach(o(t)(0))}console.log(e),MIDI.loadPlugin({soundfontUrl:"./soundfont/",instrument:"acoustic_grand_piano",onprogress:function(e,t){console.log(e,t)},onsuccess:t})}e("./lib/midi");var o=e("lodash.curry");t.exports=r},{"./lib/midi":3,"lodash.curry":4}]},{},[1]);